<html>

<head>
  <title>MUD</title>
  <style>
  body {
    background-color: black;
    height: 100%;
    margin: 0px;
    padding: 0px;
    border: 0px;
  }
  
  #flexbox {
    height: 100%;
    flex-flow: column;
    display: flex;
  }
  
  table {
    border: 0px;
  }
  
  tr {
    border: 0px;
  }
  
  td {
    font-family: Courier;
    border: solid white 1px;
  }
  
  pre {
    font-family: Courier;
  }
  
  #log {
    background-color: black;
    color: green;
    margin: 0px;
    padding: 0px;
    border: 0px;
    height: 100%;
    font-family: Courier;
    overflow-y: scroll;
    flex: 0 1 auto;
  }
  
  #inputArea {
    flex: 0 1 25px;
    margin: 0px;
    padding: 0px;
    border: 0px;
  }
  
  input[type=text] {
    background-color: black;
    color: gainsboro;
    width: 100%;
    font-family: Courier;
  }
  
  .green {
    color: green;
  }
  
  .red {
    color: red;
  }
  
  .aqua {
    color: aqua;
  }
  
  .cyan {
    color: cyan;
  }
  
  .darkCyan {
    color: darkcyan;
  }
  
  .gray {
    color: gray;
  }
  
  .silver {
    color: silver;
  }
  
  .white {
    color: white;
  }
  
  .purple {
    color: purple;
  }
  
  .teal {
    color: teal;
  }
  
  .mediumOrchid {
    color: mediumOrchid;
  }
  
  .olive {
    color: olive;
  }
  
  .gainsboro {
    color: gainsboro;
  }
  </style>
  <script src="http://localhost:3000/socket.io/socket.io.js"></script>
  <script>
  var commandHistory = [];
  var historyIndex = -1;

  var socket = io("http://localhost:3000");

  socket.on('output', function(data) {
    var ta = document.getElementById('log');

    var newHTML = data.message.replace(/\n/g, '<br />\n');
    ta.innerHTML = ta.innerHTML + newHTML + '<br />';
    ta.scrollTop = ta.scrollHeight;
  });

  function sendData(e) {
    if (!e) e = window.event;
    var tb = document.getElementById("textData");
    var keyCode = e.keyCode || e.which || e.charCode;

    // esc
    if (keyCode === 27) {
      tb.value = '';
      historyIndex = -1;
    }

    // up arrow
    if (keyCode == 38) {
      historyIndex++;
      if (historyIndex > commandHistory.length - 1) historyIndex = commandHistory.length - 1;
      tb.value = commandHistory[historyIndex];
    }

    // down arrow
    if (keyCode == 40) {

      // if you push the down arrow when history index is already 0, just blank the field and return.
      historyIndex--;
      if (historyIndex > -1) {
        tb.value = commandHistory[historyIndex];
      } else {
        tb.value = '';
      }
      if (historyIndex < -1) historyIndex = -1;
    }

    // enter press
    if (keyCode == 13) {
      socket.emit('command', {
        value: tb.value
      });
      commandHistory.unshift(tb.value); // save command
      commandHistory.splice(25); // only save 25 commands
      historyIndex = -1;
      tb.value = '';
      return false;
    }
  }

  function focusInput() {
    document.getElementById("textData").focus();
  }
  </script>
</head>

<body>
  <div id="flexbox" onclick="focusInput()">
    <div id="log"></div>
    <div id="inputArea">
      <input id="textData" onkeydown="return sendData(event)" type="text" />
    </div>
  </div>
</body>
<script>
(function() {
  focusInput();
})();
</script>

</html>
